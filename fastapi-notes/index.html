<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notes App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#3b82f6",
              secondary: "#8b5cf6",
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <!-- Toast Notification -->
    <div
      id="toast"
      class="hidden fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all duration-300"
    ></div>

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex justify-between items-center">
          <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
            üìù Notes App
          </h1>
          <div class="flex items-center gap-4">
            <!-- Dark Mode Toggle -->
            <button
              id="darkModeToggle"
              class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
            >
              <svg
                id="sunIcon"
                class="w-6 h-6 text-gray-800 dark:text-gray-200 hidden dark:block"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                ></path>
              </svg>
              <svg
                id="moonIcon"
                class="w-6 h-6 text-gray-800 dark:text-gray-200 block dark:hidden"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                ></path>
              </svg>
            </button>
            <button
              id="createNoteBtn"
              class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-lg font-medium transition-colors"
            >
              + New Note
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Search Bar -->
      <div class="mb-6">
        <input
          type="text"
          id="searchInput"
          placeholder="üîç Search notes by title..."
          class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
        />
      </div>

      <!-- Loading Spinner -->
      <div id="loading" class="hidden text-center py-12">
        <div
          class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"
        ></div>
        <p class="mt-4 text-gray-600 dark:text-gray-400">Loading notes...</p>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="hidden text-center py-12">
        <svg
          class="mx-auto h-24 w-24 text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          ></path>
        </svg>
        <h3 class="mt-4 text-xl font-medium text-gray-900 dark:text-white">
          No notes yet
        </h3>
        <p class="mt-2 text-gray-600 dark:text-gray-400">
          Get started by creating your first note!
        </p>
      </div>

      <!-- Notes Grid -->
      <div
        id="notesGrid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
      ></div>
    </main>

    <!-- Modal for Create/Edit Note -->
    <div
      id="noteModal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
      >
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h2
              id="modalTitle"
              class="text-2xl font-bold text-gray-900 dark:text-white"
            >
              Create New Note
            </h2>
            <button
              id="closeModal"
              class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>
          <form id="noteForm">
            <div class="mb-4">
              <label
                for="noteTitle"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >Title</label
              >
              <input
                type="text"
                id="noteTitle"
                required
                class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none"
                placeholder="Enter note title"
              />
            </div>
            <div class="mb-6">
              <label
                for="noteContent"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >Content</label
              >
              <textarea
                id="noteContent"
                required
                rows="8"
                class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none resize-none"
                placeholder="Write your note here..."
              ></textarea>
            </div>
            <div class="flex justify-end gap-3">
              <button
                type="button"
                id="cancelBtn"
                class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-lg transition-colors"
              >
                Save Note
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Configuration
      const API_BASE_URL = "http://localhost:8000";

      // State
      let currentNoteId = null;
      let allNotes = [];

      // DOM Elements
      const noteModal = document.getElementById("noteModal");
      const noteForm = document.getElementById("noteForm");
      const noteTitleInput = document.getElementById("noteTitle");
      const noteContentInput = document.getElementById("noteContent");
      const notesGrid = document.getElementById("notesGrid");
      const loading = document.getElementById("loading");
      const emptyState = document.getElementById("emptyState");
      const toast = document.getElementById("toast");
      const searchInput = document.getElementById("searchInput");
      const modalTitle = document.getElementById("modalTitle");
      const darkModeToggle = document.getElementById("darkModeToggle");

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        loadNotes();
        initializeEventListeners();
        initializeDarkMode();
      });

      // Event Listeners
      function initializeEventListeners() {
        document
          .getElementById("createNoteBtn")
          .addEventListener("click", openCreateModal);
        document
          .getElementById("closeModal")
          .addEventListener("click", closeModal);
        document
          .getElementById("cancelBtn")
          .addEventListener("click", closeModal);
        noteForm.addEventListener("submit", handleSubmit);
        searchInput.addEventListener("input", handleSearch);
        darkModeToggle.addEventListener("click", toggleDarkMode);

        // Close modal on outside click
        noteModal.addEventListener("click", (e) => {
          if (e.target === noteModal) closeModal();
        });
      }

      // Dark Mode
      function initializeDarkMode() {
        const isDark = localStorage.getItem("darkMode") === "true";
        if (isDark) {
          document.documentElement.classList.add("dark");
        }
      }

      function toggleDarkMode() {
        document.documentElement.classList.toggle("dark");
        const isDark = document.documentElement.classList.contains("dark");
        localStorage.setItem("darkMode", isDark);
      }

      // Toast Notifications
      function showToast(message, type = "success") {
        toast.textContent = message;
        toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all duration-300 ${
          type === "success" ? "bg-green-500" : "bg-red-500"
        }`;
        toast.classList.remove("hidden");

        setTimeout(() => {
          toast.classList.add("hidden");
        }, 3000);
      }

      // API Calls
      async function loadNotes() {
        try {
          loading.classList.remove("hidden");
          notesGrid.classList.add("hidden");
          emptyState.classList.add("hidden");

          const response = await fetch(`${API_BASE_URL}/notes/`);
          if (!response.ok) throw new Error("Failed to fetch notes");

          allNotes = await response.json();
          displayNotes(allNotes);
        } catch (error) {
          console.error("Error loading notes:", error);
          showToast("Failed to load notes", "error");
        } finally {
          loading.classList.add("hidden");
        }
      }

      async function createNote(title, content) {
        try {
          const response = await fetch(`${API_BASE_URL}/notes/`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title, content }),
          });

          if (!response.ok) throw new Error("Failed to create note");

          showToast("Note created successfully!");
          await loadNotes();
        } catch (error) {
          console.error("Error creating note:", error);
          showToast("Failed to create note", "error");
        }
      }

      async function updateNote(id, title, content) {
        try {
          const response = await fetch(`${API_BASE_URL}/notes/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title, content }),
          });

          if (!response.ok) throw new Error("Failed to update note");

          showToast("Note updated successfully!");
          await loadNotes();
        } catch (error) {
          console.error("Error updating note:", error);
          showToast("Failed to update note", "error");
        }
      }

      async function deleteNote(id) {
        if (!confirm("Are you sure you want to delete this note?")) return;

        try {
          const response = await fetch(`${API_BASE_URL}/notes/${id}`, {
            method: "DELETE",
          });

          if (!response.ok) throw new Error("Failed to delete note");

          showToast("Note deleted successfully!");
          await loadNotes();
        } catch (error) {
          console.error("Error deleting note:", error);
          showToast("Failed to delete note", "error");
        }
      }

      // UI Functions
      function displayNotes(notes) {
        notesGrid.innerHTML = "";

        if (notes.length === 0) {
          emptyState.classList.remove("hidden");
          notesGrid.classList.add("hidden");
          return;
        }

        emptyState.classList.add("hidden");
        notesGrid.classList.remove("hidden");

        notes.forEach((note) => {
          const noteCard = createNoteCard(note);
          notesGrid.appendChild(noteCard);
        });
      }

      function createNoteCard(note) {
        const card = document.createElement("div");
        card.className =
          "bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow p-6 border border-gray-200 dark:border-gray-700";

        const truncatedContent =
          note.content.length > 150
            ? note.content.substring(0, 150) + "..."
            : note.content;

        card.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-3 line-clamp-2">${escapeHtml(
                  note.title
                )}</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4 whitespace-pre-wrap">${escapeHtml(
                  truncatedContent
                )}</p>
                <div class="flex justify-end gap-2 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="openEditModal('${
                      note.id
                    }')" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors text-sm font-medium">
                        Edit
                    </button>
                    <button onclick="deleteNote('${
                      note.id
                    }')" class="px-3 py-1.5 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded hover:bg-red-200 dark:hover:bg-red-800 transition-colors text-sm font-medium">
                        Delete
                    </button>
                </div>
            `;

        return card;
      }

      function openCreateModal() {
        currentNoteId = null;
        modalTitle.textContent = "Create New Note";
        noteTitleInput.value = "";
        noteContentInput.value = "";
        noteModal.classList.remove("hidden");
        noteTitleInput.focus();
      }

      async function openEditModal(id) {
        try {
          const response = await fetch(`${API_BASE_URL}/notes/${id}`);
          if (!response.ok) throw new Error("Failed to fetch note");

          const note = await response.json();
          currentNoteId = id;
          modalTitle.textContent = "Edit Note";
          noteTitleInput.value = note.title;
          noteContentInput.value = note.content;
          noteModal.classList.remove("hidden");
          noteTitleInput.focus();
        } catch (error) {
          console.error("Error loading note:", error);
          showToast("Failed to load note", "error");
        }
      }

      function closeModal() {
        noteModal.classList.add("hidden");
        currentNoteId = null;
        noteForm.reset();
      }

      async function handleSubmit(e) {
        e.preventDefault();

        const title = noteTitleInput.value.trim();
        const content = noteContentInput.value.trim();

        if (!title || !content) {
          showToast("Please fill in all fields", "error");
          return;
        }

        if (currentNoteId) {
          await updateNote(currentNoteId, title, content);
        } else {
          await createNote(title, content);
        }

        closeModal();
      }

      function handleSearch(e) {
        const searchTerm = e.target.value.toLowerCase().trim();

        if (searchTerm === "") {
          displayNotes(allNotes);
          return;
        }

        const filteredNotes = allNotes.filter((note) =>
          note.title.toLowerCase().includes(searchTerm)
        );

        displayNotes(filteredNotes);
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Make functions globally accessible for onclick handlers
      window.openEditModal = openEditModal;
      window.deleteNote = deleteNote;
    </script>
  </body>
</html>
